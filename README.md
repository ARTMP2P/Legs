# *1. Запуск виртуального окружения*
```
source venv/bin/activate
```
# *2. Установка библиотек*
```
pip install -r req.txt
```
[requirements](./req.txt)
# *3. Запуск файла*
Для обучения нейросети с нуля, необходимо просто запустить файл [main.py](./main.py):
```
python3 main.py
```
Для продолжения обучения с уже имеющимися весами, необходимо при запуске ввести параметром путь к сохраненным весам:
```
python3 main.py path/to/weights
```
[main](./main.py)
Данный код используется для обучения генеративно-состязательной сети (GAN) на заданном наборе данных. Он импортирует необходимые модули и функции из других файлов, определяет необходимые параметры, в том числе количество эпох обучения и размер изображения, а также создает и компилирует модели дискриминатора, генератора и GAN. Затем он запускает функцию обучения с заданными параметрами и набором данных.
Также код включает настройку работы TensorFlow с GPU для эффективного использования ресурсов вычислительной машины.
Все функции для обучения упакованы в пакет [learning](./learning)

# *4. Пути и переменные*

Все значимые переменные хранятся в файле vars.py


```python
CHANEL, SIZE = 8, 1024
```
- Задается количество каналов и размер изображения
```python
n_steps, batch = 200000, 4
```
- Задается шаг и размер батча
```python
y1, y2, x1, x2
```
- 
```python
lr = 0.0001
```
- Рейт обучения
```python
n_epochs
```
- Количество этапов на эпоху обучения, задается в файле [main.py](./main.py)
```python
dir_file_txt = 'dir/to/txt/file/with/paths.txt'
```
- Путь к файлу со списком директорий, который получается в ходе работы прарсера для каждой папки датасета

```python
dir_260_clear_file_txt = 'dir/to/txt/file/with/clear/paths.txt'
```
- Путь к файлу с переработанными путями к файлам, так же получается в ходе работы парсера датасета.

```python
dir_model_NN = 'data_a/models'
```
- Путь сохранения весов
```python
img_test_group = 'data_a/img_test_group'
```
- 
```python
img_test = 'data_a/img_test'
```
- Путь к изображениям полученным в ходе тестирования работы сети после каждого периода обучения
```python
root_25 = 'data_a/rendered_models'
```

```python
root = 'data/training_dataset/'
```
- Путь к корневой папки датасета для обучения

```python
rakurs = ['yaw_0',
          'yaw_55',
          'yaw_90',
          'yaw_125',
          'yaw_180',
          'yaw_235',
          'yaw_270',
          'yaw_305']
```
- Список ракурсов в датасете
# *5. Дополнительные функции:*

## 1. Парсер датасета.
Парсер предназначен для изменения размеров изображений в формате PNG, которые находятся в указанной входной директории и ее подпапках, до размеров 1024х1024 пикселей с сохранением пропорций и обрезкой до квадрата. Измененные изображения сохраняются в новых директориях, создаваемых в указанной выходной директории в соответствии с исходными директориями, содержащими файлы изображений. Функции работают через функции в файле [parser.py](./parser.py)

Программа запускается через командную строку с помощью Python и принимает два обязательных аргумента: путь к входной директории с изображениями и путь к выходной директории для сохранения измененных изображений.

Для обработки изображений программа создает пул потоков, количество потоков равно количеству доступных процессоров, затем проходит по всем файлам PNG во входной директории и ее подпапках, добавляя задачи в пул потоков. Каждая задача заключается в изменении размера изображения и сохранении его в новой папке, соответствующей структуре исходной папки. В конце работы все потоки завершаются.

Функция process_file принимает два аргумента: путь к исходному файлу изображения и путь к директории, в которой необходимо сохранить измененное изображение. Функция resize_png изменяет размер изображения и сохраняет его в указанной директории.

Запуск:
```python
    python3 parser.py
```
## 2. АПИ для работы сервиса:
Апи расположено в корне и работает как обычно через запуск скрипта 
```python
python api.py
```
На вход принимает архив с изображениями, сохраняет его, запускает его обработку через встроенные функции, которые находятся в папке [functions](./functions) и возвращает архив с обработанными изображениями.

# 5. Результат выполнения по каждой эпохе
```
3145left
3.5756945610046387 |(суммарный mIoU по всем ракурсам модели стопы)
3091right
2.9930591583251953
3200right
3.2172441482543945
287left
3.704690933227539
3122right
3.207266330718994
3057left
2.8534770011901855
```
